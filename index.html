<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Visualizer</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap");

            body,
            html {
                margin: 0;
                padding: 0;
                height: 100%;
                overflow: hidden;
                background-color: #111;
                font-family: "Poppins", sans-serif;
                color: #fff;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #visualizer-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1;
            }

            #visualizer {
                width: 100%;
                height: 100%;
            }

            #ui-container {
                position: absolute;
                bottom: 40px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                flex-direction: column;
                align-items: center;
                z-index: 10;
                width: 80%;
                max-width: 500px;
            }

            #controls {
                display: flex;
                gap: 20px;
                margin-bottom: 20px;
            }

            .control-btn {
                background-color: rgba(255, 255, 255, 0.1);
                border: 2px solid rgba(255, 255, 255, 0.3);
                color: #fff;
                padding: 12px 24px;
                border-radius: 30px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 18px;
                backdrop-filter: blur(10px);
                outline: none;
            }

            .control-btn:hover {
                background-color: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.5);
                transform: translateY(-2px);
            }

            .control-btn:active {
                transform: translateY(1px);
            }

            #time-display {
                font-size: 24px;
                letter-spacing: 2px;
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
                margin-bottom: 20px;
            }

            #progress-bar {
                width: 100%;
                height: 6px;
                background-color: rgba(255, 255, 255, 0.2);
                border-radius: 3px;
                overflow: hidden;
            }

            #progress {
                width: 0;
                height: 100%;
                background-color: #00ffff;
                transition: width 0.1s linear;
            }

            #volume-control {
                position: absolute;
                top: 20px;
                right: 20px;
                display: flex;
                align-items: center;
            }

            #volume-slider {
                -webkit-appearance: none;
                width: 100px;
                height: 4px;
                background: rgba(255, 255, 255, 0.3);
                outline: none;
                opacity: 0.7;
                transition: opacity 0.2s;
            }

            #volume-slider:hover {
                opacity: 1;
            }

            #volume-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 15px;
                height: 15px;
                background: #00ffff;
                cursor: pointer;
                border-radius: 50%;
            }

            #volume-slider::-moz-range-thumb {
                width: 15px;
                height: 15px;
                background: #00ffff;
                cursor: pointer;
                border-radius: 50%;
            }

            #volume-icon {
                margin-right: 10px;
                font-size: 24px;
            }

            #url-input-card {
                background-color: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 15px;
                padding: 30px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                text-align: center;
                max-width: 400px;
                width: 90%;
                z-index: 100;
                opacity: 0;
                transition: opacity 0.5s ease, transform 0.5s ease;
                transform: scale(0.9);
            }

            #url-input-card.visible {
                opacity: 1;
                transform: scale(1);
            }

            #url-input-card h2 {
                margin-top: 0;
                margin-bottom: 20px;
                font-weight: 600;
            }

            #url-input {
                width: 100%;
                padding: 12px;
                margin-bottom: 20px;
                border: none;
                border-radius: 8px;
                background-color: rgba(255, 255, 255, 0.2);
                color: #fff;
                font-size: 16px;
                outline: none;
                transition: background-color 0.3s ease;
            }

            #url-input:focus {
                background-color: rgba(255, 255, 255, 0.3);
            }

            #submit-url,
            #repeat-song {
                background-color: #00ffff;
                color: #111;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-top: 10px;
            }

            #submit-url:hover,
            #repeat-song:hover {
                background-color: #00cccc;
                transform: translateY(-2px);
            }
        </style>
    </head>
    <body>
        <div id="visualizer-container">
            <canvas id="visualizer"></canvas>
        </div>

        <div id="url-input-card" class="visible">
            <h2>Enter Music URL</h2>
            <input type="text" id="url-input" placeholder="https://example.com/music.mp3" />
            <button id="submit-url">Start Visualizer</button>
            <button id="repeat-song" style="display: none;">Repeat Song</button>
        </div>

        <div id="ui-container" style="display: none;">
            <div id="time-display">0:00 / 0:00</div>
            <div id="progress-bar"><div id="progress"></div></div>
            <div id="controls">
                <button class="control-btn" id="play-pause">Play</button>
                <button class="control-btn" id="stop">Stop</button>
            </div>
        </div>

        <div id="volume-control">
            <span id="volume-icon">ðŸ”Š</span>
            <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1" />
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script>
            const urlInputCard = document.getElementById("url-input-card");
            const urlInput = document.getElementById("url-input");
            const submitUrlButton = document.getElementById("submit-url");
            const repeatSongButton = document.getElementById("repeat-song");
            const uiContainer = document.getElementById("ui-container");
            const playPauseBtn = document.getElementById("play-pause");
            const stopBtn = document.getElementById("stop");
            const timeDisplay = document.getElementById("time-display");
            const progressBar = document.getElementById("progress");
            const volumeSlider = document.getElementById("volume-slider");
            let audioPlayer,
                isPlaying = false;

            // Three.js setup
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('visualizer'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
        
            // Create visualizer elements
            const geometry = new THREE.SphereGeometry(1, 32, 32);
            const material = new THREE.MeshPhongMaterial({ color: 0xffffff, wireframe: true });
            const sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
        
            const light = new THREE.PointLight(0xffffff, 1, 100);
            light.position.set(0, 0, 10);
            scene.add(light);
        
            camera.position.z = 5;
        
            // Audio context and analyzer setup
            let audioContext, analyser, source;
        
            function setupAudioContext() {
              audioContext = new (window.AudioContext || window.webkitAudioContext)();
              analyser = audioContext.createAnalyser();
              analyser.fftSize = 256;
              source = audioContext.createMediaElementSource(audioPlayer);
              source.connect(analyser);
              analyser.connect(audioContext.destination);
            }
        
            const bufferLength = 128;
            const dataArray = new Uint8Array(bufferLength);
        
            function animate() {
              requestAnimationFrame(animate);
        
              if (analyser) {
                analyser.getByteFrequencyData(dataArray);
        
                // Calculate average frequency
                const average = dataArray.reduce((a, b) => a + b) / bufferLength;
        
                // Update sphere based on audio data
                sphere.scale.set(1 + average / 256, 1 + average / 256, 1 + average / 256);
                sphere.rotation.x += 0.01;
                sphere.rotation.y += 0.01;
        
                // Update light color based on frequency
                const hue = (average / 256) * 360;
                light.color.setHSL(hue / 360, 1, 0.5);
              }
        
              renderer.render(scene, camera);
            }
        
            animate();

            submitUrlButton.addEventListener("click", () => {
                const url = urlInput.value.trim();
                if (url) {
                    loadAudio(url);
                    urlInputCard.classList.remove("visible");
                    uiContainer.style.display = "flex";
                }
            });

            repeatSongButton.addEventListener("click", () => {
                if (audioPlayer) {
                    audioPlayer.currentTime = 0;
                    audioPlayer.play();
                    urlInputCard.classList.remove("visible");
                    uiContainer.style.display = "flex";
                }
            });

            playPauseBtn.addEventListener("click", () => {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    isPlaying = true;
                    playPauseBtn.textContent = "Pause";
                } else {
                    audioPlayer.pause();
                    isPlaying = false;
                    playPauseBtn.textContent = "Play";
                }
            });

            stopBtn.addEventListener("click", () => {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                isPlaying = false;
                playPauseBtn.textContent = "Play";
            });

            volumeSlider.addEventListener("input", () => {
                if (audioPlayer) audioPlayer.volume = volumeSlider.value;
            });

            function loadAudio(url) {
                if (audioPlayer) {
                    audioPlayer.pause();
                    audioPlayer.src = "";
                }

                audioPlayer = new Audio(url);
                audioPlayer.crossOrigin = "anonymous";
                audioPlayer.volume = volumeSlider.value;
                audioPlayer.play();
                isPlaying = true;
                playPauseBtn.textContent = "Pause";

                audioPlayer.addEventListener("timeupdate", () => {
                    const currentTime = formatTime(audioPlayer.currentTime);
                    const duration = formatTime(audioPlayer.duration);
                    timeDisplay.textContent = `${currentTime} / ${duration}`;
                    progressBar.style.width = `${(audioPlayer.currentTime / audioPlayer.duration) * 100}%`;
                });

                audioPlayer.addEventListener("ended", () => {
                    isPlaying = false;
                    playPauseBtn.textContent = "Play";
                    uiContainer.style.display = "none";
                    urlInputCard.classList.add("visible");
                    repeatSongButton.style.display = "inline-block";
                });
            }

            function formatTime(time) {
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60);
                return `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            }
        </script>
    </body>
</html>
